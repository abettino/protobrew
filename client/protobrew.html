<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome to the Taoglas Wiki</title>

<!--[if IE 5]>
<style type="text/css">
/* place css box model fixes for IE 5* in this conditional comment */
#sidebar1 { width: 230px; }
</style>
<![endif]--><!--[if IE]>
<style type="text/css">
/* place css fixes for all versions of IE in this conditional comment */
#sidebar1 { padding-top: 30px; }
#mainContent { zoom: 1; }
/* the above proprietary zoom property gives IE the hasLayout it needs to avoid several bugs */
</style>
<![endif]-->

<script type="text/javascript" src="//api.filepicker.io/v1/filepicker.js"></script>
</head>

<template name="main">

    <div class="content">
        <a class="btn btn-inverse" href="#" value="sidenav_btn" id="sidenav_btn">
            <span aria-hidden="true" data-icon="&#xe002;"></span> 
        </a> 

    {{#if currentUser}}

      {{#if modeIs "index"}}
      {{> index}}
      {{/if}}

      {{#if modeIs "users"}}
        {{> toolbar}}
        {{> entry}}
        {{> managedUsers}}
      {{/if}}

      {{#if modeIs "search"}}
      {{> search}}
      {{/if}}

      {{#if modeIs "tag"}}
      {{> tag}}
      {{/if}}

      {{#if modeIs "entry"}}
            {{> toolbar}}
            {{> entry}}
      {{/if}}

      {{#if modeIs "profile"}}
      {{> profile}}
      {{/if}}
    {{else}}
        {{#if loginConfigured}}
            <div class="notAuth">
                Not Authorized
            </div>
        {{else}}
            <div class="notAuth">
                 <img src="http://viewvc.svn.mozilla.org/vc/addons/trunk/bandwagon/skin/images/spinner.gif?revision=18591&view=co&pathrev=18591" height="32" width="32">
            </div>
        {{/if}}
    {{/if}}

    </div>
</template>

<template name="index">
    {{{content.text}}}
</template>

<template name="profile">
    <h2>Profile for {{user.profile.name}}</h2>
    <label>Username
        <input name="username" type="text" id="username" value="{{user.profile.username}}" />
        <input type="submit" value="save" id="save" />
    </label>
</template>

<template name="search">
    <h3>Search results for "{{term}}"</h3>

    {{#each results}}
        <h2><a href="/{{this.title}}">{{this.title}}</a></h2>
        <p>{{this.text}}</p>
    {{/each}}

</template>

<template name="tag">
    <h3>Entries tagged with "{{tag}}"</h3>

    {{#each results}}
        <h2><a href="/{{this.title}}">{{this.title}}</a></h2>
        <p>{{this.text}}</p>
    {{/each}}

</template>

<template name="entry">

    <div id="entry">


        <h1 id="article-title" class="article-title">
            {{#if userContext}}{{userContext}} / {{/if}}{{title}}
        </h1>

        {{#if edit_mode}}
        <form>

            {{#with entry}}
            {{> editEntry}}
            {{/with}}

            {{#if adminable}}
            <p>
                <label>Mode
                    <select id="mode" name="mode">
                        <option {{#if modeIs "public"}}selected{{/if}} value="public">Public</option>
                        <option {{#if modeIs "read-only"}}selected{{/if}} value="read-only">Read-Only</option>
                        <option {{#if modeIs "private"}}selected{{/if}} value="private">Private</option>
                    </select>
                </label>
            </p>
            {{/if}}
        </form>
        {{else}}

        {{#if entry._id}}

                {{#if viewable}}


                    <p>{{{entry.text}}}</p>

                    {{#if entry.tags.length}}
                    <h2>Tags</h2>
                    <ul>
                        {{#each entry.tags}}
                        <li class="article-tag"><a href="javascript:void(0);">{{this}}</a></li>
                        {{/each}}
                    </ul>
                    {{/if}}

                {{else}}

                <p>{{entry.title}} is private.</p>

                {{/if}}

            {{else}}

                {{#if entryLoaded}}
                    <p>{{title}} doesn't exist yet.</p>
                        {{#if currentUser}}
                        	<a class="action-btn" href="#" value="edit" id="edit"><span aria-hidden="true" data-icon="&#x22;"></span> Create it!</a>
                        {{/if}}
                {{else}}    
                    <img src="http://viewvc.svn.mozilla.org/vc/addons/trunk/bandwagon/skin/images/spinner.gif?revision=18591&view=co&pathrev=18591" height="32" width="32">

                {{/if}}

            {{/if}}

        {{/if}}
    </div>

</template>


<template name="editEntry">
    <textarea id="entry-text" placeholder="Just some friendly placeholder text.">{{text}}</textarea>

    <p>
        <h2>Tags</h2>
        <textarea id="entry-tags"></textarea>
        <small><em>press &#x23ce; between tags</em></small>
    </p>
</template>

<template name="user">
    {{info}}
</template>


<template name="leftNav">
  <div id="left_nav">
    <div id="logo">
        <a href="/">
            <img src='/images/logo.png' alt='Toaglas Wiki'>
        </a></div>
    {{#if currentUser}}
    <div id="search" class="navbar-search pull-left" >
            <input class="txtOptionInput searchField search-query" type="search" results="5" size="15" placeholder="Search" accesskey="F" autocomplete="off" lastsearchtext="aasdfasdfsd" placeholder="" id="search-input" value="{{term}}"></div>

    <nav>
    	<ul class="nav nav-list">
            {{#isolate}}
    		<li {{#if pageIs "/"}}class="selected"{{/if}}>
                <a class="left-nav" href="/">
                    <span aria-hidden="true" data-icon="&#x68;"></span> Home
                </a>
            </li>
			<li {{#if pageIs "Articles"}}class="selected"{{/if}}><a class="left-nav" href="/Articles"><span aria-hidden="true" data-icon="&#x6e;"></span> Articles</a></li>
			<li {{#if pageIs "users"}}class="selected"{{/if}}><a class="left-nav" href="/users"><span aria-hidden="true" data-icon="&#x6e;"></span> Users</a></li>
            {{/isolate}}
    	</ul>
    </nav>
    {{/if}}

    <div id="buttons" >
        {{loginButtons}}
    </div>

    {{#if currentUser}}
    <user>

            <ul class="nav nav-tabs" id="userTabs">
                <li id="editedTab" class="{{#if isActiveTab 'editedTab'}} active {{/if}}">
                    <a class='tabButton'>Edited</a>
                </li>
                <li id="starredTab" class="{{#if isActiveTab 'starredTab'}} active {{/if}}">
                    <a class='tabButton'>Starred</a>
                </li>
            </ul>

        <div id="usernav" class="tab-content">   
                <div id="edited" class="tab-pane {{#if isActiveTab 'editedTab'}} active {{/if}}">
                    <ul>
                        {{#each edited}}
                            <li><a class="left-nav" href="{{entryLink this}}">{{this.title}}</a></li>
                        {{/each}}
                    </ul>
                </div> 
            <div id="starred" class="tab-pane {{#if isActiveTab 'starredTab'}} active {{/if}}" >
                    <ul>
                        {{#each starred}}
                        <li><a class="left-nav" href="{{entryLink this}}">{{this.title}}</a></li>
                        {{/each}}
                    </ul>
            </div>
        </div>
    </user>
    {{/if}}
  </div><!-- end #left_nav -->


</template>

<template name="null">

  <div id="header"></div>
    <div id = "leftNavContainer">
        {{> leftNav}}
    </div>
  <div id="main">
    {{> main}}
    <div id="footer">
    </div>
  </div>

  {{#if currentUser}}
	<div id="sidebar_col">
        <div id="sidebar">
            {{> sidebar}}
        </div>
	</div>
    <!-- end #sidebar -->
  {{/if}}
</template>

<body>
  <div id="container">
      {{> null}}
  </div>
  {{> newUserModal }}
</body>

<template name="sidebar">
    <ul>
         {{{ navItems }}}
    </ul>
</template>

<template name="newUserModal">

    <div id="new-user-modal" class="modal hide fade">
        <div class="modal-header">
            <h3>Welcome</h3>
        </div>
        
        {{#isolate}}
        <div class="modal-body">
            <p>Please pick a username</p>
            <input type="text" id="initial-username-input"/>
            {{#if usernameTaken }}
            <span class="red">Taken</span>
            {{/if}}
        </div>
        
        <div class="modal-footer">
            <a id="new-username-button" href="javascript:void(0);" class="btn btn-primary{{#if continueDisabled}} disabled{{/if}}">Continue</a>
        </div>
        {{/isolate}}
    </div>
</template>


<template name="toolbar">

        {{#if edit_mode}}
            <div id='edit_mode_toolbar'class="action-toolbar edit_mode">
                <a class="btn btn-danger" href="#" value="delete" id="delete"><span aria-hidden="true" data-icon="&#x64;"></span></a>
                <a class="btn btn-warning" href="#" value="cancel" id="cancel"><span aria-hidden="true" data-icon="&#x62;"></span></a>
                <a class="btn btn-success" href="#" value="save" id="save"><span aria-hidden="true" data-icon="&#x22;"></span> Save</a>
            </div>
        {{else}}


                <div id= "user_toolbar" class="action-toolbar">
                    <a class="btn" href="#" value="new_page" id="new_page">
                        <span aria-hidden="true" data-icon="&#xe001;"></span> 
                        New
                    </a>
                    <a class="btn" href="#" value="toggle_star" id="toggle_star">
                        <span aria-hidden="true" data-icon="&#xe004;"></span> 
                        Star
                    </a>

                    {{#if editable}}
                        <a class="btn" href="#" value="edit" id="edit">
                            <span aria-hidden="true" data-icon="&#x23;"></span> 
                            Edit
                        </a>
                     {{/if}}

                </div>


        {{/if}}
</template>




<template name="managedUsers">
    <div class="row-fluid">
        <table class="table table-hover span11">
            <thead>
                <tr>
                    <th class="span3">Username</th>
                    <th class="span3">Full Name</th>
                    <th class="span3">Email Address</th>
                    <th class="span2"></th>
                </tr>
            </thead>
            <tbody>
                {{#each systemUsers}}
                    <tr>
                        <td class="span3">
                            <span class="username">{{username}}</span>
                        </td>
                        <td class="span3">
                            <span class="fullName">{{profile.name}}</span>
                        </td>
                        <td class="span3">
                            <span class="emailAddress">
                                {{emailAddress this}}
                            </span>
                        </td>
                        <td class="span2">
                            <i class="icon-edit editUser" data-toggle="modal" data-target="#{{_id}}_edit"></i>
                            <i class="icon-remove remove-user"></i>
                            <!-- template managedUserEditModal -->
                        </td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
    <div class="row-fluid">
        <hr/>
    </div>
<!--     <div class="row-fluid">
        <form id="newUser" class="well form-horizontal span6">
            <legend>New User</legend>
            {{#isolate}}
                {{#if newManagedUserError}}
                    <div class="row-fluid span11 alert alert-error">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        <h4>Error</h4>
                        {{newManagedUserError}}
                    </div>
                {{/if}}
            {{/isolate}}
            template managedUserForm
            <div class="control-group">
                <div class="controls">
                    <button id="submit" type="button" class="btn btn-primary">Save changes</button>
                    <button id="cancel" type="button" class="btn">Cancel</button>
                </div>
            </div>
        </form>
    </div> -->
</template>

<!-- <template name="managedUserEditModal">
    <div id="{{_id}}_edit" class="modal hide fade editModal" role="dialog" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Edit User</h3>
        </div>
        <div class="modal-body">
            <form class="well form-horizontal">
                {{#isolate}}
                    {{#if editManagedUserError}}
                        <div class="row-fluid span11 alert alert-error">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <h4>Error</h4>
                            {{editManagedUserError}}
                        </div>
                    {{/if}}
                {{/isolate}}
                template managedUserForm
            </form>
            <div class="row-fluid">
                <span class="span12 text-right">
                    <button class="btn passwordReset">Send Password Reset Email</button>
                </span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary editSave">Save changes</button>
        </div>
    </div>
</template> -->

<!-- <template name="managedUserForm">
    <fieldset>
        <div class="control-group">
            <label class="control-label" for="username">Username</label>
            <div class="controls">
                <input class="username" type="text"/>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="name">Full Name</label>
            <div class="controls">
                <input class="name" type="text"/>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="email">Email</label>
            <div class="controls">
                <input class="email" type="text"/>
            </div>
        </div>
        {{#if permissions}}
            <div class="control-group">
                <label class="control-label">Permissions</label>
                <div class="controls permissions">
                    {{#each permissions}}
                        <label class="checkbox">
                            <input class="{{name}} permission" type="checkbox">{{description}}
                        </label>
                    {{/each}}
                </div>
            </div>
        {{/if}}
    </fieldset>
</template> -->
